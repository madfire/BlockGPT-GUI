## 1.开发环境

- Node.js > 8 (推荐使用版本14，过高的Node版本在某些情况下也会导致编译失败)
- python2.7
- git
- Java

```sh
mkdir openblock
cd openblock
git clone --depth 3 https://github.com/openblockcc/openblock-gui
git clone https://github.com/openblockcc/openblock-link
git clone https://github.com/openblockcc/openblock-resource
```

报错

```sh
gyp ERR! find VS
gyp ERR! find VS msvs_version not set fr                                                                                                                                                                                                                                                                                                                                                                                                                                                                               om command line or npm config
```

npm安装依赖

```sh
npm install --g --production windows-build-tools
npm install @abandonware/bluetooth-hci-socket   
```

```shell
npm config delete proxy

npm config delete https-proxy
```

npm设置代理

```
npm config set proxy http://127.0.0.1:7890
npm config set https-proxy http://http://127.0.0.1:7890
```

npm cache clean --force

```sh
cd openblock-gui
npm install
cd ..
cd openblock-link
npm install
npm run fetch
cd ..
cd openblock-resource
npm install
npm run fetch
cd ..

```

运行

1. 启动硬件接口服务器 openblock-link

   ```sh
   cd openblock-link
   npm start
   ```

   报错，openblock-link\tools 缺少python编译器，需复制一个micropython编译器内容，参考其他link环境

2. 启动外部插件与设备服务器 openblock-resource

   在新的一个终端中执行。

   ```sh
   cd openblock-resource
   npm start
   ```

3. 启动 openblock-gui

   在新的一个终端中执行。

   ```sh
   cd openblock-gui
   npm run start-open
   ```

4. 在 openblock-gui 的 webpack 构建完成后，将会有弹出 openblock-gui 的网页。当然你也可以通过手动输入地址 `http://127.0.0.1:8601/` 来访问。

获取全部的核心软件包[¶](https://openblockcc.github.io/en/developer/develop-from-source/quick-start/#_5

1. 克隆 openblock-blocks 与 openblock-vm，关于这些软件包各自的作用，你可以阅读[**构架介绍**](https://openblockcc.github.io/en/developer/develop-from-source/framework-introduction/)来了解。

   ```sh
   git clone --depth 3 https://github.com/openblockcc/openblock-blocks
   git clone --depth 3 https://github.com/openblockcc/openblock-vm
   ```

2. 安装和链接

   `link` 指令会以本地npm包替换项目内默认的包，这样你在 openblock-blocks 等包中的修改才会被 openblock-gui 使用，否则它默认使用的将会是从npm服务器下载的内容，你可以查看 openblock-gui/node_modules 下的 openblock-blocks 与 openblock-vm 的文件夹，如果 link 成功，那么他们将被链接到本地克隆下来的工程的位置。

   ```sh
   cd openblock-blocks
   npm install
   npm link
   cd ..
   cd openblock-vm
   npm install
   npm link
   cd ..
   cd openblock-gui
   npm install
   npm link openblock-blocks openblock-vm
   cd ..
   ```

## 2.架构介绍

![img](https://openblockcc.github.io/en/developer/develop-from-source/asset/offlineFramework.png)

工程整体以 Node.js 开发，其中的代码以 npm 包的方式根据功能做分割发布，并在顶层被调用封包为一个整体软件。其中核心的几个功能包为：

- openblock-gui 基于 React 的前端用户界面。
- openblock-vm 管理状态和运行后台逻辑代码，接收 GUI 的操作请求并发送状态和事件给 GUI。简要来说就是 gui 中积木块执行或是于硬件交互等功能均是由 vm 来进行实际逻辑处理和发送到接口服务器的。
- openblock-blocks 从Google [Blockly](https://developers.google.com/blockly/) 项目创建的分支。这个仓库同时处理实现积木块（blocks）的 UI 显示、逻辑功能以及代码生成功能。
- openblock-link 通过 websocket 为 openblock 提供本地硬件接口服务，与本地运行的编译软件服务。
- openblock-resource 通 过websocket 为 openblock 提供本地插件即第三方设备的内容。

而后根据软件在线版和离线版两个不同得到部署方式，他们又被不同的方式进行打包和发布。

![onlineFramework](https://openblockcc.github.io/en/developer/develop-from-source/asset/onlineFramework.png)

## 3.添加开发板

### 3.1开发板UI

**格式**：png

**分辨率**：600x372

**背景色**：白色

<img src="https://hq.iclass365.com:6281/eMaker/static/assets/d6610865df4af044ef54c7584ec8fc36.png" alt="img" style="zoom:50%;" />

https://www.aconvert.com/image/ 转换png为svg，将其分别设置为 **108x87\**和\**40x40**。

将108x87 的图片名称为：`<board name>-illustration.svg`

将40x40 的图片名称为：`<board name>-small.svg`

将制作好的三张图片放置到以控制板的名称命名的文件夹中，将其移动到路径`openblock-gui\src\lib\libraries\devices\`

```sh
openblock-gui\src\lib\libraries\devices\
  |- arduinoLeonardo\
  |- arduinoMega2560\
    |- baseToolbox\
    |- ...
    |- <board name>\
      |- <board name>.png
      |- <board name>-illustration.svg
      |- <board name>-small.svg
    |- index.jsx

```

修改`index.jsx`

1. 在`openblock-gui\src\lib\libraries\devices\index.jsx`文件中，你可以看到已经有一些设备的代码在这里了，以Arduino UNO的参数举例。

   首先，在文件顶部 import 图片资源：

   ```
   import arduinoUnoIconURL from './arduinoUno/arduinoUno.png';
   import arduinoUnoConnectionIconURLL from './arduinoUno/arduinoUno-illustration.svg';
   import arduinoUnoConnectionSmallIconURL from './arduinoUno/arduinoUno-small.svg';
   ```

   而后， 在下方设置设备参数：

   ```
   {
       name: 'Arduino Uno',
       deviceId: 'arduinoUno',
       manufactor: 'arduino.cc',
       leanMore: 'https://store.arduino.cc/usa/arduino-uno-rev3',
       type: 'arduino',
       iconURL: arduinoUnoIconURL,
       description: (
           <FormattedMessage
               defaultMessage="A great board to get started with electronics and coding."
               description="Description for the Arduino Uno device"
               id="gui.device.arduinoUno.description"
           />
       ),
       featured: true,
       disabled: false,
       bluetoothRequired: false,
       serialportRequired: true,
       defaultBaudRate: '9600',
       internetConnectionRequired: false,
       launchPeripheralConnectionFlow: true,
       useAutoScan: false,
       connectionIconURL: arduinoUnoConnectionIconURLL,
       connectionSmallIconURL: arduinoUnoConnectionSmallIconURL,
       connectingMessage: (
           <FormattedMessage
               defaultMessage="Connecting"
               description="Message to help people connect to their arduino."
               id="gui.device.arduino.connectingMessage"
           />
       ),
       baseToolBoxXml: arduinoBaseToolBox,
       programMode: ['realtime', 'upload'],
       programLanguage: ['block', 'c', 'cpp'],
       tags: ['arduino'],
       helpLink: 'https://store.arduino.cc/usa/arduino-uno-rev3'
   }
   ```

   - name

   设备显示的名称。

   - deviceId

   设备ID，将被在openblock-vm加载设备时使用。

   - baseDeviceId

   仅在由基础控制板衍生的第三方控制板中使用。用于标明该控制板由哪个控制板衍生， 如在被赋值为 `arduinoUno` 时，这将使得该套件可以在插件选择界面中加载使用为 Arduino UNO 控制板编写的插件。

   - manufactor

   这个将在设备选择界面中的制造商条目中显示。

   - leanMore

   可放置制造商链接，将在点击设备名称或了解更多的按钮时打开，建议设定为公司网站或商城地址。

   - type

   告诉GUI该使用哪个代码生成器。

   - iconURL

   将在设备选择界面中显示。

   - description

   将会在设备选择界面的iconURL下方显示，这里使用了FormattedMessage来提供多种语言下的不同翻译内容。

   - featured

   这是一个内部参数，他始终应该被设置为true。

   - disabled

   如果设置为true，将会禁用这个设备选项，将显示为灰色并无法被选取。

   - bluetoothRequired/serialportRequired/internetConnectionRequired

   设置为true将在设备选择界面要求栏中显示对应连接的图标，这几个参数只用于显示图标不会影响实际的连接功能。

   - defaultBaudRate

   默认串口波特率，选择设备后会自动根据此值设置串口终端的波特率。

   - launchPeripheralConnectionFlow

   设置为true会在选择设备后开启设备连接界面，建议设置为true。

   - useAutoScan

   设置为true，将会自动连接扫描出的设备，不建议开启。

   - connectionIconURL

   将用于在设备连接界面中显示。

   - connectionSmallIconURL

   将显示在设备连接界面的顶部栏中。

   - connectingMessage

   这个信息将在设备连接时显示，不建议修改此内容。

   - baseToolBoxXml

   提供设备的基础积木内容，不建议修改。

   - programMode

   在设备不支持对应的编程模式时，会自动切换到支持的模式并锁定模式切换开关。同时也控制在设备选择界面中编程模式栏中的显示。

   - programLanguage

   仅用于在设备选择界面中编程语言栏中控制图标显示。

   - tags

   用于设定设备类目，在点击上方过滤器时生效。

   - extensions

     为该数组赋值可以在选择控制板后，自动加载设定的插件。如在赋值为 `dht11` 时，在选择该控制板后 dht11 插件将被自动加载。

   - helpLink

     将用于设备连接界面中，点击该界面中的帮助按钮就会打开这个链接，建议设定至产品在线Wiki地址。

2. 在完成这些工作后，你应该能够在设备选择界面中看到新添加的设备了，但是如果我们点击它，什么都不会发送，我们仍需要在openblock-vm 中添加设备的代码。

### 3.2硬件代码

1. 在`openblock-vm\src\devices`路径下创建一新的文件夹，命名为控制板的名称，如：`arduinoUno`。复制`src\devices\arduinoUno\index.js`到这个新的文件夹中，完成后文件树结构将如下所示：

   ```
   openblock-vm\src\devices\
       |- arduinoLeonardo\
       |- arduinoMega2560\
       |- ...
       |- <board name>\
           |- index.js
   ```

2. 现在我们来开始修改index.js文件。

   在文件中，代码注释的都已经很详细了，下面仅介绍你需要修改的内容部分，和文件框架结构。

   这个文件中分两个 Class，`ArduinoUno`与`OpenBlockArduinoUnoDevice`，前者负责实现与硬件的接口通讯等内容，后者用于实现设备的积木块内容，同时会调用前者，通过前者的接口函数积木开在实时模式下的功能代码。

   - PID/VID过滤器

     ```
     const PNPID_LIST = [
         //https://github.com/arduino/Arduino/blob/1.8.0/hardware/arduino/avr/boards.txt#L51-L58
         'USB\\VID_2341&PID_0043',
         'USB\\VID_2341&PID_0001',
         'USB\\VID_2A03&PID_0043',
         'USB\\VID_2341&PID_0243',
         // For chinese clones that use CH340
         'USB\\VID_1A86&PID_7523'
         // Uncomment this to close filter
         // '*'
     ];
     ```

     这个列表将会控制 openblock-link 过滤串口设备，防止用户为计算机上自带的串口或其他不相关设备的串口所困惑。

   - 串口参数

     ```
     const CONFIG = {
         baudRate: 57600,
         dataBits: 8,
         stopBits: 1
     };
     ```

     用于设定在实时模式下连接设备时使用的波特率等参数。

   - 设备编译与烧录参数

     ```
     const DIVECE_OPT = {
         type: 'arduino',
         fqbn: 'arduino:avr:uno',
         firmware: 'arduinoUno.standardFirmata.ino.hex'
     }
     ```

     `type` 告诉 openblock-link 使用哪种编译器和烧写软件来接收处理上传请求。

     `fqbn` 用于提供给 arduino_builder。设定这个参数与我们在Arduino IDE中选择控制板类型的操作本质是一样的。 访问[Arduino manpage.adoc](https://github.com/arduino/Arduino/blob/master/build/shared/manpage.adoc#options)了解更多参数选项和含义。

     `firmware` 用于设定控制板使用的实时模式固件。

   - 目录与积木

     ```
     getInfo() {
         return [
             {
                 // ...
                  blocks: [
                         {
                             // ...
                             programMode: [ProgramModeType.UPLOAD]
                         }
                      ]
                 //...
             },
         {
                 //...
             }
         ]
     }
     ```

   此处返回的是一个对象数组，包含多个积木目录。其中programMode用于设定积木支持的编程模式，如果没有设定这个参数则默认都支持。

添加设备到 extension manager[¶](https://openblockcc.github.io/en/developer/develop-from-source/add-a-new-board/#extension-manager

在 `openblock-vm\src\extension-support\extension-manager.js` 行数32附近，将你的新的设备 index 文件在列表中加入。

```
const builtinDevices = {
    arduinoUno: () => require('../devices/arduinoUno'),
    arduinoNano: () => require('../devices/arduinoNano')
    <board id>: () => require('../devices/<board name>')
};
```

openblock-blocks 中添加代码转译函数

目前Arduino设备对应的转码函数需要添加在 `openblock-blocks\generators\arduino\arduino.js`中。

下面以`setDigitalOutput`积木的代码转译函数为例。

```
Blockly.Arduino['arduino_pin_setDigitalOutput'] = function (block) {
  var arg0 = block.getFieldValue('PIN') || '0';
  var arg1 = Blockly.Arduino.valueToCode(block, 'LEVEL', Blockly.Arduino.ORDER_UNARY_POSTFIX) || 'LOW';
  var code = "digitalWrite(" + arg0 + ", " + arg1 + ");\n";
  return code;
};
```

显然这个函数的名称与 vm 中对应积木的 opcode 不同，这是因为在 vm 中，是通过一些函数处理才生产了 blocks 中定义积木的结构，在这个过程中积木的 id 组成规则为：

```
${device.type}_${categoryInfo.id}_${blockInfo.opcode}
```

即 <设备类型+目录id+积木id>。所以 pin 目录下的 setDigitalOutput 积木的 id 就变成了`arduino_pin_setDigitalOutput`。

设备类型：arduino,microbit,microPython

还有一点特别的是，如果积木菜单定义了`acceptReporters: true`属性，那么其值既可以下拉菜单选择，也可以被放置入的积木覆盖，在没有积木放入时其下拉菜单的值会被视为是一个新的积木。其 id 生成规则为：

```
${device.type}_${categoryInfo}_menu_${xmlEscape(menuName)}
```

即 <设备类型+目录名称+menu+菜单名称>。所以 setDigitalOutput 积木的 level 菜单就需要定义为`pin_menu_level`，这样才能在没有积木放置进入时正确解析。

```
Blockly.Arduino['arduino_pin_menu_level'] = function (block) {
  var code = block.getFieldValue('level') || 'LOW';
  return [code, Blockly.Arduino.ORDER_ATOMIC];
};
```

- 快速调试

  由于 openblock-blocks 需要重新编译打包的问题，使得其调试过程及其繁琐，我们可以在 GUI 中导入 openblock-blocks 的位置对其函数进行重写，来实现快速调试。

  在`openblock-gui\src\lib\blocks.js`中，`openblock-blocks`被导入为`ScratchBlocks`我们直接在这个文件的 `export default function` 中添加想要调试的转译函数，对 ScratchBlocks 的内容进行补充或重写，不过注意这里头部的`Blockly`变量要改名 `ScratchBlocks`。

  ```
  /**
   * Connect scratch blocks with the vm
   * @param {VirtualMachine} vm - The scratch vm
   * @return {ScratchBlocks} ScratchBlocks connected with the vm
   */
  export default function (vm) {
      // ...
      ScratchBlocks.Arduino['pin_setDigitalOutput'] = function (block) {
        var arg0 = block.getFieldValue('PIN') || '0';
        var arg1 = Blockly.Arduino.valueToCode(block, 'LEVEL', Blockly.Arduino.ORDER_UNARY_POSTFIX) || 'LOW';
        var code = "digitalWrite(" + arg0 + ", " + arg1 + ");\n";
        return code;
      };
  }
  ```

  在这里加入的转译函数的效果与openblock-blocks中添加效果是一样的。在完成功能调试后，我们再将正确的代码移动到openblock-block中，将`ScratchBlocks`替换回`Blockly`，并将 blocks.js 文件恢复原样即可。

### 3.3控制台代码更改

gui/src/components/hardware-console

```css
@import "../../css/units.css";
@import "../../css/colors.css";
@import "../../css/z-index.css";

.hardware-console-wrapper {
    display: flex;
    flex-direction: column;
    position: relative;
}

.console-array {
    height: 260px;
    overflow:auto;
    word-break:break-all;
	white-space: pre-wrap;
    user-select: text;
    /*color: $text-primary; */
    /*背景设置为黑色，字体为白色*/
    color: white;
    background-color: black;
    font-family: "monospace", Helvetica, Arial, sans-serif;
    font-size: $menu-bar-standard-font-size;
    padding-left: 0.25em; /* 右移半个字符 */
    padding-top: 0.25em; /* 下移半个字符 */
}

.button:hover {
    cursor: pointer;
}

.pause-button {
    position: absolute;
    top: -1px;
    right: -1px;
    border: 1px solid $ui-black-transparent;
    background-color: $ui-white;
    height: 34px;
    width: 34px;
    border-radius: 0 0.5rem 0 0;
    outline: none;
}

.clean-button {
    position: absolute;
    top: calc(34px - 2px);
    right:  -1px;
    border: 1px solid $ui-black-transparent;
    background-color: $ui-white;
    height: 34px;
    width: 34px;
    border-radius: 0 0 0 0.5rem;
    outline: none;
}

.pause-button:active,
.clean-button:active{
    background-color: $ui-black-transparent;
}

.clean-icon {
    height: 20px;
    width: 20px;
}

.pause-icon{
    height: 20px;
    width: 20px;
}

.console-menu-warpper {
    display: flex;
    flex-wrap: nowrap;
    flex-direction: row;
    justify-content: flex-end;
    height: 42px;
    background-color: $ui-white;
    align-items: center;
    border-top: 1px solid $ui-black-transparent;
}

.console-input {
    flex-grow: 1;
    height: 26px;
    margin-left: $space;
    border: 1px solid $ui-black-transparent;
    box-sizing: border-box;
    border-radius: 0.5rem;
    background-color: $ui-secondary;
    overflow:hidden;
}

.console-input:focus {
    outline:none;
    border: 1px solid $ui-transparent;
    -webkit-box-shadow: 0 0 0 calc($space * .25) $ui-modal-overlay;
    box-shadow: 0 0 0 calc($space * .25) $ui-modal-overlay;
    color: $text-primary;
}

.send-button {
    padding: 0.36rem 0.75rem;
    border-radius: 0.5rem;
    background: $motion-primary;
    color: white;
    font-weight: 600;
    font-size: 0.75rem;
    margin-left: 0.5rem;
    margin-right: 0.5rem;
    border: none;
    outline: none;
    cursor: pointer;
    white-space:nowrap;
}

.send-button:active{
    opacity: 0.5;
}

.setting-button {
    border: none;
    outline: none;
    cursor: pointer;
    background-color: $ui-white;
    padding: 0;
    margin-right: $space;
    white-space: nowrap;
    position: relative;
}

.setting-icon {
    height: 26px;
    width: 26px;
}

.menu-bar-menu {
    z-index: $z-index-menu-bar;
}

.menu {
    background-color: $ui-white;
    color: $text-primary;
    bottom: 36px;
    min-width: 0px;
    text-align: left;
}

.menu span {
    margin-right: 5px;
    vertical-align: middle;
}

.menu input {
    vertical-align: middle;
    margin: 0;
}

.menu select {
    border: 1px solid $text-primary;
    color: $text-primary;
}

.menu select:focus {
    outline:none;
    border: 1px solid $ui-transparent;
    -webkit-box-shadow: 0 0 0 calc($space * .25) $ui-modal-overlay;
    box-shadow: 0 0 0 calc($space * .25) $ui-modal-overlay;
    color: $text-primary;
}

```

#### 3.3.1清空输入框

```js
import React, { useState } from 'react';

const HardwareConsoleComponent = props => {
    const [inputValue, setInputValue] = useState('');

    const {
        onClickSend,
        onInputChange,
        onKeyPress // 保留此回调
    } = props;

    const handleSendClick = () => {
        if (inputValue.trim() !== '') {
            onClickSend(inputValue);
            setInputValue('');
        }
    };

    // 监听键盘事件，检测是否按下 Enter 键
    const handleKeyDown = (e) => {
        if (e.key === 'Enter') { // 或者使用 e.keyCode === 13
            e.preventDefault(); // 阻止默认行为（例如换行）
            handleSendClick();   // 触发发送逻辑
        }
    };

    return (
        <Box className={styles.hardwareConsoleWrapper}>
            <Box className={styles.consoleMenuWarpper}>
                <input
                    className={styles.consoleInput}
                    value={inputValue}
                    onChange={e => {
                        setInputValue(e.target.value);
                        if (onInputChange) {
                            onInputChange(e);
                        }
                    }}
                    onKeyDown={handleKeyDown} // 监听键盘按下事件
                />
                <button
                    className={classNames(styles.button, styles.sendButton)}
                    onClick={handleSendClick}
                >
                    <FormattedMessage
                        defaultMessage="Send"
                        description="Button in bottom to send data to serialport"
                        id="gui.hardwareConsole.send"
                    />
                </button>
            </Box>
        </Box>
    );
};

export default HardwareConsoleComponent;

```

#### 3.3.2添加运行、停止按钮

openblock-gui\src\components\hardware-console\hardware-console.css添加

```js
/* 2024-09-09 by Ran */
.run-button {
    position: absolute;
    top: calc(34px * 2 - 4px); /* Adjust the top position to be below the clean button */
    right: -1px;
    border: 1px solid $ui-black-transparent;
    background-color: $ui-white;
    height: 34px;
    width: 34px;
    border-radius: 0 0 0 0.5rem; /* Adjust border-radius to match styling */
    outline: none;
}

.run-button:active {
    background-color: $ui-black-transparent;
}

.run-icon {
    height: 23px;
    width: 23px;
}
```

jsx更改

```jsx
import React, { useState } from 'react';
import { FormattedMessage, intlShape } from 'react-intl';
import PropTypes from 'prop-types';
import classNames from 'classnames';
import ScrollableFeed from 'react-scrollable-feed';

import Box from '../box/box.jsx';
import MenuBarMenu from '../menu-bar/menu-bar-menu.jsx';
import { MenuItem, MenuSection } from '../menu/menu.jsx';
import styles from './hardware-console.css';
import cleanIcon from './clean.svg';
import settingIcon from './setting.svg';
import pauseIcon from './pause.svg';
import startIcon from './start.svg';
import runIcon from './exec.svg'; // 运行图标
import endIcon from './end.svg'; // 结束图标

const toHexForm = buffer => Array.prototype.map.call(buffer,
    x => x.toString(16).toUpperCase()).join(' ');

const HardwareConsoleComponent = props => {
    const [inputValue, setInputValue] = useState(''); 
    const [isRunning, setIsRunning] = useState(false); // 管理运行状态

    const {
        baudrate,
        baudrateList,
        consoleArray,
        eol,
        eolList,
        intl,
        isAutoScroll,
        isHexForm,
        isPause,
        onClickClean,
        onClickPause,
        onClickSerialportMenu,
        onClickHexForm,
        onClickAutoScroll,
        onClickSend,
        onInputChange,
        onKeyPress,
        onKeyDown,
        onRequestSerialportMenu,
        onSelectBaudrate,
        onSelectEol,
        serialportMenuOpen
    } = props;

    const handleSendClick = () => {
        if (inputValue.trim() !== '') {
            onClickSend(inputValue);
            setInputValue('');
        }
    };

    const handleKeyDown = (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            handleSendClick();
        }
    };

    const handleRunEndClick = () => {
        if (isRunning) {
            // 处理“结束”逻辑
            // 执行结束操作
        } else {
            // 处理“运行”逻辑
            // 执行运行操作
        }
        setIsRunning(!isRunning); // 切换状态
    };

    return (
        <Box className={styles.hardwareConsoleWrapper}>
            <Box className={styles.consoleArray}>
                <ScrollableFeed
                    forceScroll={isAutoScroll}
                >
                    <span>
                        {isHexForm ? toHexForm(consoleArray) : new TextDecoder('utf-8').decode(consoleArray)}
                    </span>
                </ScrollableFeed>
            </Box>
            <button
                className={classNames(styles.button, styles.pauseButton)}
                onClick={onClickPause}
            >
                <img
                    alt="Pause"
                    className={classNames(styles.pauseIcon)}
                    src={isPause ? startIcon : pauseIcon}
                />
            </button>
            <button
                className={classNames(styles.button, styles.cleanButton)}
                onClick={onClickClean}
            >
                <img
                    alt="Clean"
                    className={classNames(styles.cleanIcon)}
                    src={cleanIcon}
                />
            </button>
            <button
                className={classNames(styles.button, styles.runButton)} // 使用新的 class
                onClick={handleRunEndClick} // 切换功能
            >
                <img
                    alt={isRunning ? 'End' : 'Run'}
                    className={classNames(styles.runIcon)}
                    src={isRunning ? endIcon : runIcon}
                />
            </button>
            <Box className={styles.consoleMenuWarpper}>
                <input
                    className={styles.consoleInput}
                    value={inputValue}
                    onChange={e => {
                        setInputValue(e.target.value);
                        if (onInputChange) {
                            onInputChange(e);
                        }
                    }}
                    onKeyPress={onKeyPress}
                    onKeyDown={handleKeyDown}
                />
                <button
                    className={classNames(styles.button, styles.sendButton)}
                    onClick={handleSendClick}
                >
                    <FormattedMessage
                        defaultMessage="Send"
                        description="Button in bottom to send data to serialport"
                        id="gui.hardwareConsole.send"
                    />
                </button>
                <button
                    className={classNames(styles.button, styles.settingButton)}
                >
                    <img
                        alt="Setting"
                        className={classNames(styles.settingIcon, {
                            [styles.active]: serialportMenuOpen
                        })}
                        src={settingIcon}
                        onMouseUp={onClickSerialportMenu}
                    />
                    <MenuBarMenu
                        className={classNames(styles.MenuBarMenu)}
                        menuClassName={styles.menu}
                        open={serialportMenuOpen}
                        place={'left'}
                        directiron={'up'}
                        onRequestClose={onRequestSerialportMenu}
                    >
                        <MenuSection >
                            <MenuItem
                                isRtl={props.isRtl}
                            >
                                <FormattedMessage
                                    defaultMessage="Buadrate"
                                    description="Serial buadrate."
                                    id="gui.hardwareConsole.buadrate"
                                />
                                <select
                                    onChange={onSelectBaudrate}
                                >
                                    {baudrateList.map(item => (
                                        <option
                                            key={item.key}
                                            selected={baudrate === item.key}
                                        >
                                            {item.value}
                                        </option>
                                    ))}
                                </select>
                            </MenuItem>
                            <MenuItem
                                isRtl={props.isRtl}
                            >
                                <FormattedMessage
                                    defaultMessage="End of line"
                                    description="End of line."
                                    id="gui.hardwareConsole.endOfLine"
                                />
                                <select
                                    onChange={onSelectEol}
                                >
                                    {eolList.map(item => (
                                        <option
                                            key={item.key}
                                            selected={eol === item.key}
                                        >
                                            {intl.formatMessage(item.value)}
                                        </option>
                                    ))}
                                </select>
                            </MenuItem>
                        </MenuSection>
                        <MenuSection >
                            <MenuItem
                                onClick={onClickHexForm}
                                isRtl={props.isRtl}
                            >
                                <FormattedMessage
                                    defaultMessage="Hex form"
                                    description="Display serial port data in hexadecimal."
                                    id="gui.hardwareConsole.hexform"
                                />
                                <input
                                    type="checkbox"
                                    name="hexform"
                                    checked={isHexForm}
                                    readOnly
                                />
                            </MenuItem>
                            <MenuItem
                                onClick={onClickAutoScroll}
                                isRtl={props.isRtl}
                                bottomLine
                            >
                                <FormattedMessage
                                    defaultMessage="Auto scroll"
                                    description="Auto scroll serialport console data."
                                    id="gui.hardwareConsole.autoScroll"
                                />
                                <input
                                    type="checkbox"
                                    name="autoScroll"
                                    checked={isAutoScroll}
                                    readOnly
                                />
                            </MenuItem>
                        </MenuSection>
                    </MenuBarMenu>
                </button>
            </Box>
        </Box>
    );
};

HardwareConsoleComponent.propTypes = {
    baudrate: PropTypes.string.isRequired,
    baudrateList: PropTypes.arrayOf(
        PropTypes.shape({
            key: PropTypes.string.isRequired,
            value: PropTypes.number.isRequired
        })),
    consoleArray: PropTypes.instanceOf(Uint8Array),
    eol: PropTypes.string.isRequired,
    eolList: PropTypes.arrayOf

```

3.3.3添加判断，micropython有在线运行

```jsx
import React, { useState } from 'react';
import { FormattedMessage, intlShape } from 'react-intl';
import PropTypes from 'prop-types';
import classNames from 'classnames';
import ScrollableFeed from 'react-scrollable-feed';

import Box from '../box/box.jsx';
import MenuBarMenu from '../menu-bar/menu-bar-menu.jsx';
import { MenuItem, MenuSection } from '../menu/menu.jsx';
import styles from './hardware-console.css';
import cleanIcon from './clean.svg';
import settingIcon from './setting.svg';
import pauseIcon from './pause.svg';
import startIcon from './start.svg';
import runIcon from './exec.svg'; // 运行图标
import endIcon from './end.svg'; // 结束图标
import { getLanguageFromDeviceType } from '../../lib/device'; // Import the function

const DeviceType = {
    Python: 'python', // Define or import DeviceType
    // Other device types...
};

// 将 Uint8Array 转换为十六进制字符串
const toHexForm = buffer => Array.prototype.map.call(buffer,
    x => x.toString(16).toUpperCase()).join(' ');

const HardwareConsoleComponent = props => {
    const [inputValue, setInputValue] = useState('');
    const [isRunning, setIsRunning] = useState(false); // 管理运行状态

    const {
        baudrate,
        baudrateList,
        consoleArray,
        eol,
        eolList,
        intl,
        isAutoScroll,
        isHexForm,
        isPause,
        onClickClean,
        onClickPause,
        onClickSerialportMenu,
        onClickHexForm,
        onClickAutoScroll,
        onClickSend,
        onInputChange,
        onKeyPress,
        onKeyDown,
        onRequestSerialportMenu,
        onSelectBaudrate,
        onSelectEol,
        serialportMenuOpen,
        deviceType
    } = props;

    // Determine if the run/end icon should be displayed
    const showRunEndIcon = getLanguageFromDeviceType(deviceType) === DeviceType.Python;

    // 点击发送按钮时清空输入框
    const handleSendClick = () => {
        if (inputValue.trim() !== '') { // 确保输入不为空
            onClickSend(inputValue);    // 传递输入框的值
            setInputValue('');          // 清空输入框
        }
    };

    // 监听键盘事件，检测是否按下 Enter 键
    const handleKeyDown = (e) => {
        if (e.key === 'Enter') { // 或者使用 e.keyCode === 13
            e.preventDefault(); // 阻止默认行为（例如换行）
            handleSendClick();   // 触发发送逻辑
        }
    };

    const handleRunEndClick = () => {
        if (isRunning) {
            // 处理“结束”逻辑
            // 执行结束操作
            setIsRunning(false);
        } else {
            // 处理“运行”逻辑
            // 执行运行操作
            setIsRunning(true);
        }
    };

    return (
        <Box className={styles.hardwareConsoleWrapper}>
            <Box className={styles.consoleArray}>
                <ScrollableFeed forceScroll={isAutoScroll}>
                    <span>
                        {isHexForm ? toHexForm(consoleArray) : new TextDecoder('utf-8').decode(consoleArray)}
                    </span>
                </ScrollableFeed>
            </Box>
            <button
                className={classNames(styles.button, styles.pauseButton)}
                onClick={onClickPause}
            >
                <img
                    alt="Pause"
                    className={classNames(styles.pauseIcon)}
                    src={isPause ? startIcon : pauseIcon}
                />
            </button>
            <button
                className={classNames(styles.button, styles.cleanButton)}
                onClick={onClickClean}
            >
                <img
                    alt="Clean"
                    className={classNames(styles.cleanIcon)}
                    src={cleanIcon}
                />
            </button>
            {showRunEndIcon && (
                <button
                    className={classNames(styles.button, styles.runButton)} // 使用新的 class
                    onClick={handleRunEndClick} // 切换功能
                >
                    <img
                        alt={isRunning ? 'End' : 'Run'}
                        className={classNames(styles.runIcon)}
                        src={isRunning ? endIcon : runIcon}
                    />
                </button>
            )}
            <Box className={styles.consoleMenuWarpper}>
                <input
                    className={styles.consoleInput}
                    value={inputValue} // 确保 input 的 value 绑定到 inputValue
                    onChange={e => {
                        setInputValue(e.target.value); // 更新状态
                        if (onInputChange) {
                            onInputChange(e);         // 调用父组件的回调
                        }
                    }}
                    onKeyPress={onKeyPress}
                    onKeyDown={handleKeyDown}
                />
                <button
                    className={classNames(styles.button, styles.sendButton)}
                    onClick={handleSendClick} // 点击发送按钮后触发 handleSendClick
                >
                    <FormattedMessage
                        defaultMessage="Send"
                        description="Button in bottom to send data to serialport"
                        id="gui.hardwareConsole.send"
                    />
                </button>
                <button
                    className={classNames(styles.button, styles.settingButton)}
                >
                    <img
                        alt="Setting"
                        className={classNames(styles.settingIcon, {
                            [styles.active]: serialportMenuOpen
                        })}
                        src={settingIcon}
                        onMouseUp={onClickSerialportMenu}
                    />
                    <MenuBarMenu
                        className={classNames(styles.MenuBarMenu)}
                        menuClassName={styles.menu}
                        open={serialportMenuOpen}
                        place={'left'}
                        direction={'up'} // 修正拼写错误
                        onRequestClose={onRequestSerialportMenu}
                    >
                        <MenuSection>
                            <MenuItem isRtl={props.isRtl}>
                                <FormattedMessage
                                    defaultMessage="Baudrate"
                                    description="Serial baudrate."
                                    id="gui.hardwareConsole.baudrate"
                                />
                                <select onChange={onSelectBaudrate}>
                                    {baudrateList.map(item => (
                                        <option
                                            key={item.key}
                                            selected={baudrate === item.key}
                                        >
                                            {item.value}
                                        </option>
                                    ))}
                                </select>
                            </MenuItem>
                            <MenuItem isRtl={props.isRtl}>
                                <FormattedMessage
                                    defaultMessage="End of line"
                                    description="End of line."
                                    id="gui.hardwareConsole.endOfLine"
                                />
                                <select onChange={onSelectEol}>
                                    {eolList.map(item => (
                                        <option
                                            key={item.key}
                                            selected={eol === item.key}
                                        >
                                            {intl.formatMessage(item.value)}
                                        </option>
                                    ))}
                                </select>
                            </MenuItem>
                        </MenuSection>
                        <MenuSection>
                            <MenuItem
                                onClick={onClickHexForm}
                                isRtl={props.isRtl}
                            >
                                <FormattedMessage
                                    defaultMessage="Hex form"
                                    description="Display serial port data in hexadecimal."
                                    id="gui.hardwareConsole.hexform"
                                />
                                <input
                                    type="checkbox"
                                    name="hexform"
                                    checked={isHexForm}
                                    readOnly
                                />
                            </MenuItem>
                            <MenuItem
                                onClick={onClickAutoScroll}
                                isRtl={props.isRtl}
                                bottomLine
                            >
                                <FormattedMessage
                                    defaultMessage="Auto scroll"
                                    description="Auto scroll serialport console data."
                                    id="gui.hardwareConsole.autoScroll"
                                />
                                <input
                                    type="checkbox"
                                    name="autoScroll"
                                    checked={isAutoScroll}
                                    readOnly
                                />
                            </MenuItem>
                        </MenuSection>
                    </MenuBarMenu>
                </button>
            </Box>
        </Box>
    );
};

HardwareConsoleComponent.propTypes = {
    baudrate: PropTypes.string.isRequired,
    baudrateList: PropTypes.arrayOf(
        PropTypes.shape({
            key: PropTypes.string.isRequired,
            value: PropTypes.number.isRequired
        })
    ),
    consoleArray: PropTypes.instanceOf(Uint8Array),
    eol: PropTypes.string.isRequired,
    eolList: PropTypes.arrayOf(
        PropTypes.shape({
            key: PropTypes.string.isRequired,
            value: PropTypes.shape({
                defaultMessage: PropTypes.string.isRequired,
                description: PropTypes.string,
                id: PropTypes.string.isRequired
            })
        })
    ),
    intl: intlShape,
    isRtl: PropTypes.bool,
    isHexForm: PropTypes.bool.isRequired,
    isPause: PropTypes.bool.isRequired,
    isAutoScroll: PropTypes.bool.isRequired,
    isRunning: PropTypes.bool.isRequired, // 添加这个 prop 2024-09-06
    onClickClean: PropTypes.func.isRequired,
    onClickPause: PropTypes.func.isRequired,
    onClickAutoScroll: PropTypes.func.isRequired,
    onClickHexForm: PropTypes.func.isRequired,
    onClickSend: PropTypes.func.isRequired,
    onClickSerialportMenu: PropTypes.func.isRequired,
    onInputChange: PropTypes.func.isRequired,
    onKeyPress: PropTypes.func.isRequired,
    onKeyDown: PropTypes.func.isRequired,
    onClickRun: PropTypes.func.isRequired, // 添加这个回调 2024-09-06
    onClickEnd: PropTypes.func.isRequired, // 添加这个回调 2024-09-06
    onRequestSerialportMenu: PropTypes.func.isRequired,
    onSelectBaudrate: PropTypes.func.isRequired,
    onSelectEol: PropTypes.func.isRequired,
    serialportMenuOpen: PropTypes.bool.isRequired,
    deviceType: PropTypes.string.isRequired // Add deviceType to propTypes
};

export default HardwareConsoleComponent;

```

3.3.3修改D:\2023luoan\emaker\openblock-gui\src\containers\hardware-console.jsx

```jsx
handleClickSend (data) {
       // let data = this.state.dataToSend;
        if (this.props.eol === 'lf') {
            data = `${data}\n`;
        } else if (this.props.eol === 'cr'){

            data = `${data}\r`;
        } else if (this.props.eol === 'lfAndCr'){

            data = `${data}\r\n`;
        }
        this.writeToPeripheral(data);
    }
```

把handleclick从无参函数变为含参

#### 3.3.4 控制台调试

cltr shit i进入控制台调试

### 3.4 mpfs上传

```
repl: exec(open('main.py').read())
```

exec('print(1)')

### 3.5 添加k210硬件

openblock-vm\src\devices\ecool\ecool.js

```js
const formatMessage = require('format-message');

const ArgumentType = require('../../extension-support/argument-type');
const BlockType = require('../../extension-support/block-type');
const ProgramModeType = require('../../extension-support/program-mode-type');

const CommonPeripheral = require('../common/common-peripheral');

/**
 * The list of USB device filters.
 * @readonly
 */
const PNPID_LIST = [
    // CH340
    'USB\\VID_1A86&PID_7523'
];

/**
 * Configuration of serialport
 * @readonly
 */
const SERIAL_CONFIG = {
    baudRate: 115200,
    dataBits: 8,
    stopBits: 1,
    dtr: false,
    rts: false
};

/**
 * Configuration for arduino-cli.
 * @readonly
 */
const DIVECE_OPT = {
    type: 'microPython',
    chip: 'k210',
    baud: '1500000',
    firmware: 'maixpy_v0.6.2_73_g1a4f278a5_openmv_kmodel_v4_with_ide_support.bin',
    board: 'dan',
    rtsdtr: false
};

class Ecool extends CommonPeripheral{
    /**
     * Construct a Ecool communication object.
     * @param {Runtime} runtime - the OpenBlock runtime
     * @param {string} deviceId - the id of the extension
     * @param {string} originalDeviceId - the original id of the peripheral, like xxx_arduinoUno
     */
    constructor (runtime, deviceId, originalDeviceId) {
        super(runtime, deviceId, originalDeviceId, PNPID_LIST, SERIAL_CONFIG, DIVECE_OPT);
    }
}

class OpenBlockEcoolDevice {
    /**
     * @return {string} - the ID of this extension.
     */
    get DEVICE_ID () {
        return 'ecool';
    }
    /**
     * Construct a set of Arduino blocks.
     * @param {Runtime} runtime - the OpenBlock runtime.
     * @param {string} originalDeviceId - the original id of the peripheral, like xxx_arduinoUno
     */
    constructor (runtime, originalDeviceId) {
        /**
         * The OpenBlock runtime.
         * @type {Runtime}
         */
        this.runtime = runtime;

        // Create a new K210 peripheral instance
        this._peripheral = new Ecool(this.runtime, this.DEVICE_ID, originalDeviceId);
    }

    /**
     * @returns {Array.<object>} metadata for this extension and its blocks.
     */
    getInfo () {
        return [
        {
            id: 'console',
            name: formatMessage({
                id: 'ecool.category.console',
                default: 'Console',
                description: 'The name of the ecool device console category'
            }),
            color1: '#FF3399',
            color2: '#CC297A',
            color3: '#CC297A',
            blocks: [
                {
                    opcode: 'consolePrint',
                    text: formatMessage({
                        id: 'ecool.console.consolePrint',
                        default: 'print [TEXT]',
                        description: 'ecool console print'
                    }),
                    blockType: BlockType.COMMAND,
                    arguments: {
                        TEXT: {
                            type: ArgumentType.STRING,
                            defaultValue: 'Hello ecool!'
                        }
                    }
                }
            ],
            menus: { }
        }
        ];
    }
}

module.exports = OpenBlockEcoolDevice;

```

对应openblockcc地址 webpack:///./node_modules/openblock-vm/src/devices/microPythonK210/microPythonK210.js?734b

### 20240912

bug出现 资源无法访问

Access to fetch at 'https://assets.scratch.mit.edu/assets/951765ee7f7370f120c9df20b577c22f.png' from origin 'http://127.0.0.1:8601' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.

解决办法

**替换为本地资源，待解决**

https://www.jianshu.com/p/1de0de82c4f5

更改了logo，调整菜单栏选项

更改了

​      // 从第二行开始发送

​      lines.slice(1).forEach(line => {

​        onClickSend(line); 

​       });

bug出现，报错会多报一行，原因是黏贴模式问题

### 20240913

腾讯云

```shell
 export NODE_OPTIONS=--openssl-legacy-provider  #nodejs版本太高，解除ssl
 npm start
```

### 20240914

1.积木支持嵌套，acceptReporters:true:

则设置代码为Blockly.Python.valueToCode

不支持为getFieldValue

2.设置reporter不可选

```js
 disableMonitor: true,
```

3.设置report积木

  return [code, Blockly.Python.ORDER_ATOMIC];

系统自带的Blockly.Python.ORDER_UNARY_POSTFIX

打印字体的Blockly.Python.ORDER_FUNCTION_CALL

### 20240918

block模板

```js
{
            id: 'sensor',                                                         // 传感器id
            name: formatMessage({												  // 传感器介绍
                id: 'ecool.category.sensor',
                default: 'Sensor',
                description: 'The name of the ecool device sensor category'
            }),
            menuIconURI: sensorIconURI,                                           // 图标
            color1: '#1296db',                                                    // 积木颜色
            blocks: [
                {
                    opcode: 'sensorinit',                                         
                    text: formatMessage({
                        id: 'ecool.sensor.sensorinit',
                        default: 'Sensor Init: Format[PIX] Size[SIZE] SkipFrame[SKIPFRAME]',
                        description: 'ecool sensor init'
                    }),
                    blockType: BlockType.COMMAND,
                    arguments: {
                        PIX: {
                            type: ArgumentType.STRING,
                            menu: 'pix',
                            defaultValue: 'RGB565'
                        },
                        SIZE: {
                            type: ArgumentType.STRING,
                            menu: 'size',
                            defaultValue: 'QVGA'
                        },
                        SKIPFRAME: {
                            type: ArgumentType.NUMBER,
                            defaultValue: 100
                        }
                    }
                },
                // snapshot
                {
                    opcode: 'snapshot',
                    text: formatMessage({
                        id: 'ecool.sensor.snapshot',
                        default: 'Sensor Snapshot',
                        description: 'ecool sensor snapshot'
                    }),
                    blockType: BlockType.REPORTER,
                    disableMonitor: true
                },
            ],
            menus: { 
                pix: {
                    items: [
                        {
                            text: formatMessage({
                                id: 'ecool.sensor.pix.RGB565',
                                default: 'RGB565',
                                description: 'ecool sensor pix RGB565'
                            }),
                            value: 'RGB565'
                        },
                        {
                            text: formatMessage({
                                id: 'ecool.sensor.pix.GRAYSCALE',
                                default: 'GRAYSCALE',
                                description: 'ecool sensor pix GRAYSCALE'
                            }),
                            value: 'GRAYSCALE'
                        }
                    ]
                },
                size: {
                    items: [
                        {
                            text: formatMessage({
                                id: 'ecool.sensor.size.320x240',
                                default: '320x240',
                                description: 'ecool sensor size 320x240'
                            }),
                            value: 'QVGA'
                        },
                        {
                            text: formatMessage({
                                id: 'ecool.sensor.size.160x120',
                                default: '160x120',
                                description: 'ecool sensor size 160x120'
                            }),
                            value: 'QQVGA'
                        }
                    ]
                }
            }

        },
```

更新内容：

vm ：openblock-vm\src\devices\ecool\ecool.js

gui:    openblock-blocks\generators\python\ecool.js

### 20240923

修改文件后缀名名

openblock-gui\src\containers\sb3-downloader.jsx 

```jsx
const getProjectFilename = (curTitle, defaultTitle) => {
    let filenameTitle = curTitle;
    if (!filenameTitle || filenameTitle.length === 0) {
        filenameTitle = defaultTitle;
    }
    return `${filenameTitle.substring(0, 100)}.bp3`;   // 修改文件后缀名为bp3
};
```

上传添加bp3后缀

openblock-gui\src\lib\sb-file-uploader-hoc.jsx

```jsx
        createFileObjects () {
            // redo step 7, in case it got skipped last time and its objects are
            // still in memory
            this.removeFileObjects();
            // create fileReader
            this.fileReader = new FileReader();
            this.fileReader.onload = this.onload;
            // create <input> element and add it to DOM
            this.inputElement = document.createElement('input');
            this.inputElement.accept = '.bp3,.sb,.sb2,.sb3';
            this.inputElement.style = 'display: none;';
            this.inputElement.type = 'file';
            this.inputElement.onchange = this.handleChange; // connects to step 3
            document.body.appendChild(this.inputElement);
            // simulate a click to open file chooser dialog
            this.inputElement.click();
        }
```

### 20240924

修改菜单栏

下载Scratch的多语言库 Scratch-l10n 源码，地址是：https://github.com/openblockcc/openblock-l10n
editor\interface\zh-cn.json

```js
npm i
npm run build
npm link
```

gui目录

```
npm link openblock-l10n
```


### 20240926
开始界面探索
### 20240929
添加ai实时模式

npm i ml5报错，主要是版本过低
需要npm install -g patch-package

### 20241010
更新windows

### 20241010
openblockcc最新版本对于原生插件不支持，可能需要根据旧版本重构！
20220407版本ok
查看对比
https://github.com/openblockcc/openblock-gui/compare/0.1.0-prerelease.20220407133448...0.1.0-prerelease.20240719153311

### 20241016

scratch 插件有两个地方调整

1. 添加get EXTENSION_ID()
2. return{}--->return[{}] 

### 20241017

#### src/componets目录功能

| 序号 | 目录             | 子目录               | 功能                                                         |
| ---- | ---------------- | -------------------- | ------------------------------------------------------------ |
| 1    | action-menu      | action-menu.jsx      | 弹出式菜单按钮组件（上传角色、背景文件）                     |
| 2    | alert            | alert.jsx            | 处理与设备连接相关的情况，比如设备断开连接、下载或上传固件等操作 |
| 3    | asset-panel      | asset-panel.jsx      | 利用 `Selector` 和 `Box` 进行布局，旨在构建一个资源选择和展示的面板 |
| 4    |                  | selector.jsx         | 用于管理和展示可排序的项目列表，常用于多媒体编辑器（如角色、背景等资源管理）。用户可以对项目进行删除、复制、导出等操作。 |
| 5    | audio-trimmer    | audio-selector.jsx   | 用于处理音频剪辑界面中的选择区域和播放指针。                 |
| 6    | backpack         | backpack.jsx         | 背包功能，存储积木。                                         |
| 7    | block            | block.jsx            | 支持拖拽操作                                                 |
| 8    | box              | box.jsx              | 构建灵活的布局                                               |
| 9    | browser-modal    | browser-modal.jsx    | 提示用户更新浏览器                                           |
| 10   | button           | button.jsx           | 按钮组件                                                     |
| 11   | cards            | cards.jsx            | 显示交互式的教程卡片                                         |
| 12   | close-button     | close-button.jsx     | 创建一个可以关闭或返回的按钮                                 |
| 13   | code-editor      | code-editor.jsx      | Monaco 编辑器                                                |
| 14   | coming-soon      |                      |                                                              |
| 15   | connection-modal | connection-modal.jsx | 处理上传逻辑                                                 |
| 16   |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |
|      |                  |                      |                                                              |

### 20241024
desktop
npm i
需要代理安装electron
出现bug run dist打包失败

### 20241111

#### 安装 `python2.7`

```sh
sudo apt install python2.7
```

下载 Python 2.7.9 源代码：

```sh
wget https://www.python.org/ftp/python/2.7.9/Python-2.7.9.tgz
```

可ftp上传文件，下载较慢

解压下载的文件：

```sh
tar -xvzf Python-2.7.9.tgz
```

进入解压后的目录：

```sh
cd Python-2.7.9
```

配置并安装：

```sh
./configure
make
sudo make install
```

设置 `python` 命令指向 Python 2.7.9

检查是否存在 `update-alternatives` 命令：

```sh
which update-alternatives
```

如果没有安装，使用以下命令安装：

```sh
sudo apt install update-alternatives
```

设置 Python 版本：

```sh
sudo update-alternatives --install /usr/bin/python python /usr/local/bin/python2.7 1
```

验证 Python 版本：

```sh
python --version
```

#### 安装 Node.js v14.21.3

```sh
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.0/install.sh | bash
```

安装完成后，重新加载 shell 配置文件

```sh
source ~/.bashrc
```

```sh
nvm install 14
```

设置npm源

```sh
npm config set registry https://registry.npmmirror.com/
```

#### 服务器设置外网访问

package.json

```js
"scripts": {
    "start": "webpack-dev-server --host 0.0.0.0 --port 8601"
}
```

